#!/usr/bin/env bash

set -eo pipefail

flags=""

if [[ -n "${CBLAS_BACKEND}" ]]; then
    echo "Running tests using Open BLAS"
    flags="${flags} -d cblas"
fi

if [[ -n "${VMATH_BACKEND}" ]]; then
    echo "Running tests using V Math"
    flags="${flags} -d vmath"
fi

if [[ -n "${AUTOFREE}" ]]; then
    echo "Running tests using V Math"
    flags="${flags} -autofree"
fi

echo "Executing tests with command: \"v ${flags} test .\""
v ${flags} test .

find . -name '*_test' -exec rm -f {} +
